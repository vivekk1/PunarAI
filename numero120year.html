<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numerology Mahadasha Grid</title>

    <style>
        :root {
            --border: #d1d5db;
            --bg: #f9fafb;
            --card: #ffffff;
            --primary: #4f46e5;
            --destiny: #16a34a;
            --mahadasha: #7c3aed;
            --personal: #f59e0b;
        }

        body {
            margin: 0;
            padding: 15px;
            font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
            background: var(--bg);
        }

        /* ---------- Controls ---------- */
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

            .controls input,
            .controls button {
                padding: 10px 14px;
                font-size: 15px;
                border-radius: 8px;
                border: 1px solid var(--border);
            }

            .controls button {
                background: var(--primary);
                color: #fff;
                border: none;
                cursor: pointer;
            }

                .controls button:hover {
                    opacity: 0.9;
                }

        /* ---------- Output Layout ---------- */
        #output {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }

        /* ---------- Year Card ---------- */
        .year-block {
            background: var(--card);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.06);
        }

        .year-title {
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
            color: #111827;
        }

        /* ---------- Grid ---------- */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .cell {
            aspect-ratio: 1 / 1;
            border: 1px solid var(--border);
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        /* ---------- Numbers ---------- */
        .natal {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
        }

        .destiny {
            font-size: 18px;
            font-weight: 700;
            color: var(--destiny);
        }

        .mahadasha {
            position: absolute;
            bottom: 6px;
            right: 6px;
            font-size: 18px;
            font-weight: 700;
            color: var(--mahadasha);
        }

        .personal-year {
            position: absolute;
            top: 6px;
            right: 6px;
            font-size: 16px;
            font-weight: 700;
            color: var(--personal);
        }

        /* ---------- Mobile tweaks ---------- */
        @media (max-width: 480px) {
            .year-title {
                font-size: 15px;
            }

            .natal, .destiny {
                font-size: 16px;
            }
        }
    </style>
</head>

<body>

    <div class="controls">
        <input id="dob" type="date">
        <button onclick="loadMahadasha()">Generate</button>
    </div>

    <div id="output"></div>

    <script>
        const GRID_ORDER = [3, 1, 9, 6, 7, 5, 2, 8, 4];

        function loadMahadasha() {
            const d = document.getElementById("dob").value;
            if (!d) {
                alert("Select DOB");
                return;
            }

            const [y, m, da] = d.split("-");
            const dob = `${da}-${m}-${y}`;

            fetch(`https://9c36faf0ec67.ngrok-free.app/numerology-mahadasha?dob=${dob}`, {
                headers: { "ngrok-skip-browser-warning": "true" }
            })
                .then(res => res.json())
                .then(renderAllGrids)
                .catch(() => alert("API not reachable"));
        }

        function renderAllGrids(data) {
            const container = document.getElementById("output");
            container.innerHTML = "";

            const personalYearMap = {};
            data.personal_years.forEach(p => personalYearMap[p.year] = p.personal_year);

            data.mahadasha.forEach(item => {
                container.appendChild(
                    createYearGrid(
                        item.year,
                        item.mahadasha,
                        personalYearMap[item.year],
                        data.grid,
                        data.destiny
                    )
                );
            });
        }

        function getNumberByPosition(r, c) {
            return [
                [3, 1, 9],
                [6, 7, 5],
                [2, 8, 4]
            ][r][c];
        }

        function createYearGrid(year, dasha, personalYear, natalGrid, destiny) {
            const block = document.createElement("div");
            block.className = "year-block";

            block.innerHTML = `<div class="year-title">${year}</div>`;
            const grid = document.createElement("div");
            grid.className = "grid";

            for (let r = 0; r < 3; r++) {
                for (let c = 0; c < 3; c++) {
                    const cell = document.createElement("div");
                    cell.className = "cell";

                    const cellValue = natalGrid[r][c];
                    const cellNumber = getNumberByPosition(r, c);

                    if (cellValue !== "" && Number(cellValue) !== destiny) {
                        cell.innerHTML += `<span class="natal">${cellValue}</span>`;
                    }

                    if (cellNumber === destiny) {
                        cell.innerHTML += `<span class="destiny">${destiny}</span>`;
                    }

                    if (cellNumber === dasha) {
                        cell.innerHTML += `<span class="mahadasha">${dasha}</span>`;
                    }

                    if (cellNumber === personalYear) {
                        cell.innerHTML += `<span class="personal-year">${personalYear}</span>`;
                    }

                    grid.appendChild(cell);
                }
            }

            block.appendChild(grid);
            return block;
        }
    </script>

</body>
</html>
